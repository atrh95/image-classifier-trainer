# Labeled Dataset Curator

## 概要

これは画像分類モデルのトレーニングにしようするデータセットを効率的に収集するためのツールです。また、十分にトレーニングされたMLModelに対しては、このツールは、大量のデータセットを相手にした時のMLModelの誤分類を行う確率や写真の傾向を把握するための検証ツールとしても機能します。誤分類や複数の特徴を兼ね備えていてトレーニングに向かない写真が検出される状況において、MLModelが誤分類を行う確率や誤分類を行う写真の傾向を特定することができます。

## ディレクトリ構成

```
.
├── CatAPIClient/
├── SLDuplicateChecker/
├── SLFileManager/
├── SLImageLoader/
├── SLClassifier/
├── Dataset/
│   ├── Verified/
│   └── Unverified/
├── LabeledDatasetCuratorTests/
└── main.swift
```

## 設定オプション

- `fetchImagesCount`: 取得する画像の数（デフォルト: 10）
- `classificationThreshold`: 分類の信頼度の閾値（デフォルト: 0.95）
- `batchSize`: バッチ処理のサイズ（デフォルト: 10、最小値: 10）
- `maxRetriesWhenFailedToDownload`: ダウンロード失敗時の最大リトライ回数（デフォルト: 3）

## 処理の流れ

1. 画像URLの取得
   - 指定された数の画像URLをAPIから取得
   - バッチサイズごとに処理を分割
   - 取得失敗時は最大3回までリトライ

2. 画像の処理
   - 画像のダウンロード（失敗時は最大3回までリトライ）
   - 形式の検証（jpg, jpeg, pngのみ許可）
   - 閾値0.85以上で1つの特徴のみ検出された場合に重複チェックに進む
   - 重複チェック
     * ファイル名から重複を検出
     * 画像のハッシュ値を計算して重複を検出
     * 重複が検出された場合は保存をスキップ
     * 重複がない場合は画像を保存し、ハッシュ値も保持して次回の重複チェックに使用

3. 統計情報
   - 処理時間
   - 取得したURL数
   - 無効な形式を弾いた後に処理した枚数
     * 保存した画像数（ラベル別）
     * 重複により保存をスキップした枚数
     * 複数の特徴を検知し、スキップした枚数
     * 特徴が検出されなかった枚数
   - スキップされた画像
     * 画像ダウンロード失敗数
     * 無効な形式の画像数

## テスト

`LabeledDatasetCuratorTests` ディレクトリにユニットテストが含まれており、以下の点をテストしています

* 画像データの保存（SLFileManagerTests）
  - 指定されたラベルのディレクトリに正しく保存できること
  - ファイルの存在確認が正しく動作すること
  - ファイル操作のエラーが適切に処理されること

* 重複チェック（SLDuplicateCheckerTests）
  - 確認済みと未確認の両方のディレクトリから画像ハッシュを読み込めること
  - 同じファイル名が存在する場合に重複と判定されること
  - 同じ画像ハッシュがメモリ上に存在する場合に重複と判定されること
  - 新しい画像のハッシュがメモリ上に正しく保存されること

* 画像の分類処理（SLClassifierTests）
  - 分類処理がエラーなく完了すること